<!DOCTYPE html>

<html>
<head>
	<title>Milestone 4</title>
	<link rel="icon" href="/old/favicon.ico" type="image/x-icon" />
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.2.0/mustache.min.js"></script>
	<style>
		body {
			background-color: #558C89;
			font-family: Trebuchet MS;
		}
	       body,h1,h2,h3,h4,h5,h6 {font-family: "Trebuchet MS"}
	       h1,button {font-family: "Open+Sans", Trebuchet MS}
		
	       .background{color:#558C89;}
	       .bookpadding{padding-left: 10px;}
	       .title{color:#D9853B; font-size: 30px; line-height: 110%; clear: left; border-top-style: solid;}
	       .subtitle{color:#D9853B; font-size: 20px; border-bottom-style: solid;}
	       .image{float: left; margin: 0px 10px 40px 10px; }
	       .headers{}
	       .paragraphs{line-height: 110%;}
	</style>
	<script id="booklisttemplate" type="text/template">
		{{#items}}
		
		<div class='boxitem'>
		<div class='booklistitem' id="{{id}}">
			<img src='{{volumeInfo.imageLinks.smallThumbnail}}'  width=50 /> {{volumeInfo.title}}
		</div>
		</div>
		{{/items}}
	</script>
	<script id="bookdetailstemplate" type="text/template">
		<div><input type="button" id="btnHide" value="Close This" /></div>
		<div class='book'>
			<h2>{{volumeInfo.title}}</h2>
			<img src='{{volumeInfo.imageLinks.thumbnail}}' style="float: left"/>
			<div style="margin-left: 220px"> <br> By {{volumeInfo.authors}} - {{volumeInfo.publishedDate}}
			<h4>Description</h4>
				<div>{{volumeInfo.description}}</div>
				<p><a href='{{volumeInfo.infoLink}}' target='_blank'>More Information on Goole</a></p>
			</div>
		</div>
	</script>
	<script type="text/javascript">
		 $(document).ready(function ()
    {
		 $("#btnSearch").click(function ()
        {
            $("#results").html("");
			resultspage=0;
			$("#booklist").html("");
			search(resultspage);
			
        });
		
		$("#btnMore").click(function ()
        {
			resultspage++;
			search(resultspage);
        });
		 
		 function search(page)
		 {
		 
			 var service_point="https://www.googleapis.com/books/v1/volumes";
			 
			 
				var term=$("#searchTerm").val();
				var p = page;
				var startFrom = p*10;
				var maxR = 10;
				var parameter="?q="+term+"&startIndex="+startFrom + "&maxResults=" + maxR;
				var serviceUrl = service_point+parameter;
			
			 $.getJSON(serviceUrl, function (searchResultsJson)
			 {
				var template = $('#booklisttemplate').html();
				var html = Mustache.render(template, searchResultsJson);
				$("#booklist").append(html);
				$(".booklistitem").on('click', function () 
				{ 
					getBookDetails(searchResultsJson, $(this).attr("id")); 
				});
			 });
		 }

		 function getBookDetails(searchResults, bookid)
		 {
			//it's best we issue another AJAX requet to the Books API to get book details. I just simply used the information from the search results.
			var template = $('#bookdetailstemplate').html();
			$.each(searchResults.items, function (index, book)
			{
				if (book.id == bookid)
				{
					var html = Mustache.render(template, searchResults.items[index]);
					$("#bookdetails").html(html);
					$("#bookdetails").fadeIn();
				}
			});
					 
			$("#btnHide").on('click', function ()
			{
				$("#bookdetails").fadeOut();
			});
		 }
	
		$(function(){
			$("#btnGrid").click(function (){
				$(".boxitem").css("width", "24%").css("height","150%");
				$("#box").attr("data-layout","Grid");
			});
			
			$("#btnList").click(function (){
				$(".boxitem").css("width", "99%").css("height","80%");
				$("#box").attr("data-layout","List");
			});
			
		});
		});
	</script>
	
</head>

<body>

<div id="header">
<h1>Book Search</h1>


<div id="mydiv" style="background-color: #00ccff; text-align: left; display: block;">
	<ol>
		<a href="milestone_home.html"><b>Home</b></a>
	</ol>	
</div>

<div id="searchBox" style="float: left; display: block;">
	
		<input type="text" id="searchTerm" name="searchTerm"/>
		<input type="button" id="btnSearch" value="Search"/>
		<input type="button" id="btnMore" value="Load More"/>
		<br>
		<br>
		<p>Click to switch layout: <a href="#" id='btnList'>List View</a> | <a href="#" id='btnGrid'>Grid View</a></p>
		
		<div id="total"></div>	
</div>
</div>

<br>
<br>
<br>
<br>
<br>
<br>

<div id="box" data-layout="List">
			
		
<div id="main">
	<div id="booklist"></div>
</div>
<div id="bookdetails"></div>
</div>
</body>
</html>
